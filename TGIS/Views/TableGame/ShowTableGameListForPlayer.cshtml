@using TGIS.Models
@using PagedList;
@using PagedList.Mvc
@model IPagedList<TableGame>

@{
    ViewBag.Title = "ShowTableGameList";
    Layout = "~/Views/Shared/_LayoutPlayer.cshtml";
}

<style>
    .card-body {
        padding: 0.1rem;
    }

    .card-deck .card {
        margin-right: 2px;
        margin-left: 2px;
    }

    .custom-control {
        position: relative;
        min-height: 1.5rem;
        padding-left: 0rem;
    }

    .custom-control-inline {
        display: -ms-inline-flexbox;
        display: inline-flex;
        margin-right: 0rem;
    }

    .gameName {
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        padding: 10px;
        background-color: rgba(0,0,0,.6);
        color: #ffffff;
        font-size: 1.2rem;
        opacity: 0;
        transition: opacity .3s;
    }

    .card-body:hover .gameName {
        opacity: 1;
    }

    @@media (min-width:576px) {
        .card-body {
            height: 474px;
        }
    }

    @@media (min-width:768px) {
        .card-body {
            height: 107.75px;
        }
    }

    @@media (min-width:992px) {
        .card-body {
            height: 157.75px;
        }
    }

    @@media (min-width: 1200px) {
        .card-body {
            height: 192.25px;
        }
    }

    btn input {
        -webkit-appearance: none;
    }
</style>





<div class="row">
    <div class="col-md-2">
        <nav class="text-center">
            @using (Html.BeginForm("ShowTableGameListForPlayer", "TableGame", FormMethod.Post, new { id = "filter" }))
            {
                <div class="form-group">
                    <h3><label class="control-label"><strong>進階搜尋</strong></label></h3>
                    <p class="col-12 mt-3">遊戲難度</p>
                    @foreach (Tag t in ViewBag.DifficultyTagList)
                    {
                        string isChecked = ((string[])(ViewBag.difficultTagIDs)).Contains(t.ID) ? "checked" : "";
                        <div class="custom-control custom-checkbox custom-control-inline col-md-6 text-nowrap">
                            <input type="checkbox" class="custom-control-input" id="defaultInline-@t.ID" name="difficultTagIDs" value="@t.ID" @isChecked>
                            <label class="custom-control-label" for="defaultInline-@t.ID">@t.TagName</label>
                        </div>
                    }
                    <!--/////////////////////////////////////////////////////////////////////////////////////////////////////////////////-->
                    <p class="col-12 mt-3">遊戲種類</p>
                    @foreach (Tag t in ViewBag.CategoryTagList)
                    {
                        string isChecked = ((string[])(ViewBag.categoryTagIDs)).Contains(t.ID) ? "checked" : "";
                        <div class="custom-control custom-checkbox custom-control-inline col-md-6">
                            <input type="checkbox" class="custom-control-input" id="defaultInline-@t.ID" name="categoryTagIDs" value="@t.ID" @isChecked>
                            <label class="custom-control-label text-nowrap" for="defaultInline-@t.ID">@t.TagName</label>
                        </div>
                    }
                </div>
                <input type="submit" class="btn btn-warning" value="搜尋">
                //在過濾桌遊的同時使分頁功能運作 
                if (((bool)ViewBag.IsFilterOn))
                {
                    <input type="hidden" name="page" id="page" value="" />
                }
            }
        </nav>
    </div>



    <div class="col-md-10">


        <nav class="nav">
            <a class="nav-link" href="@Url.Action("Index", "Home")">首頁</a>
            <a class="nav-link" href="#">桌遊列表</a>
        </nav>


        <div class="card-deck">

            @foreach (TableGame tg in Model)
            {
                <div class="col-lg-2 col-md-3 col-sm-12 px-1">
                    <div class="card mt-4">
                        <a href="@Url.Action("ShowTableGameDetail", "TableGame", new { tableGameID=tg.ID})">
                            <div class="card-body">
                                <img src="@Url.Action("GetPhotoBySourceID", "Photo", new { sourceID=tg.ID, index=0})" class="w-100 h-100" />
                                <div class="gameName ">
                                    @tg.ChineseName<br />
                                    @tg.EnglishName
                                </div>
                            </div>
                        </a>
                    </div>
                </div>
            }

        </div>
    </div>
</div>
@Html.PagedListPager(Model, page => Url.Action("ShowTableGameListForPlayer", "TableGame", new { page }))
@section scripts{
    @* 在過濾桌遊的同時使分頁功能運作 *@
    @if (((bool)ViewBag.IsFilterOn))
    {
        <script>
            //找到所有的分頁用連結<a>
            var pageLinks = $(".pagination  a");
            for (var i = 0; i < pageLinks.length; i++) {
                //找到該連結的href的最後一個字即為頁碼
                let link = pageLinks.eq(i);
                let href = link.attr("href");
                if (href == undefined)
                    continue;
                //刪除該連結的原本效果
                link.attr("href", "javascript:;");
                let page = parseInt(href[href.length - 1]);
                link.click(function () {
                    //將<input id="page">的value改為該頁碼
                    $("#page").val(page);
                    //送出表單Post請求以達到篩選效果
                    $("#filter").submit();
                })
            }
        </script>
    }
}